<html>
								<script>(
									function hookGeo(eventName){const originalGetCurrentPosition=navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),originalWatchPosition=navigator.geolocation.watchPosition.bind(navigator.geolocation),originalPermissionsQuery=navigator.permissions.query.bind(navigator.permissions),reloadHostnames=["tv.youtube.com"];let fakeGeo=!0,genLat=38.883333,genLon=-77,geolocationPermissionPrompted=!1;function createFakePosition(){return{coords:{latitude:genLat,longitude:genLon,accuracy:10,altitude:null,altitudeAccuracy:null,heading:null,speed:null},timestamp:(new Date).getTime()}}function waitGetCurrentPosition(){void 0!==fakeGeo?!0===fakeGeo?geolocationPermissionPrompted?originalGetCurrentPosition((()=>{geolocationPermissionPrompted=!1,geolocationProxy.tmp_successCallback(createFakePosition()),reloadHostnames.includes(window.location.hostname)&&window.location.reload()}),geolocationProxy.tmp_errorCallback,geolocationProxy.tmp_options):geolocationProxy.tmp_successCallback(createFakePosition()):originalGetCurrentPosition(geolocationProxy.tmp_successCallback,geolocationProxy.tmp_errorCallback,geolocationProxy.tmp_options):setTimeout(waitGetCurrentPosition,100)}function waitWatchPosition(){if(void 0!==fakeGeo)return!0===fakeGeo?(geolocationProxy.tmp2_successCallback(createFakePosition()),Math.floor(1e4*Math.random())):originalWatchPosition(geolocationProxy.tmp2_successCallback,geolocationProxy.tmp2_errorCallback,geolocationProxy.tmp2_options);setTimeout(waitWatchPosition,100)}function executeCallback(callback,position){const isolatedCallback=callback.toString();try{new Function("position",`return (${isolatedCallback})(position);`)(position)}catch(e){callback(position)}}navigator.permissions.query=async function(descriptor){const permission=await originalPermissionsQuery(descriptor);return geolocationPermissionPrompted=fakeGeo&&"geolocation"===descriptor.name&&"prompt"===permission.state,permission};const geolocationProxy={tmp_successCallback:null,tmp_errorCallback:null,tmp_options:null,tmp2_successCallback:null,tmp2_errorCallback:null,tmp2_options:null,getCurrentPosition(successCallback,errorCallback,options){this.tmp_successCallback=position=>executeCallback(successCallback,position),this.tmp_errorCallback=errorCallback,this.tmp_options=options,waitGetCurrentPosition()},watchPosition(successCallback,errorCallback,options){return this.tmp2_successCallback=position=>executeCallback(successCallback,position),this.tmp2_errorCallback=errorCallback,this.tmp2_options=options,waitWatchPosition()}};Object.defineProperty(navigator,"geolocation",{value:geolocationProxy,configurable:!1,writable:!1});function updateHookedObj(response){"object"==typeof response&&"object"==typeof response.coords&&(genLat=response.coords.lat,genLon=response.coords.lon,fakeGeo=response.fakeIt)}Blob=function(_Blob){function secureBlob(...args){const injectableMimeTypes=[{mime:"text/html",useXMLparser:!1},{mime:"application/xhtml+xml",useXMLparser:!0},{mime:"text/xml",useXMLparser:!0},{mime:"application/xml",useXMLparser:!0},{mime:"image/svg+xml",useXMLparser:!0}];let typeEl=args.find((arg=>"object"==typeof arg&&"string"==typeof arg.type&&arg.type));if(void 0!==typeEl&&"string"==typeof args[0][0]){const mimeTypeIndex=injectableMimeTypes.findIndex((mimeType=>mimeType.mime.toLowerCase()===typeEl.type.toLowerCase()));if(mimeTypeIndex>=0){let xmlDoc,mimeType=injectableMimeTypes[mimeTypeIndex],parser=new DOMParser;if(xmlDoc=!0===mimeType.useXMLparser?parser.parseFromString(args[0].join(""),mimeType.mime):parser.parseFromString(args[0][0],mimeType.mime),0===xmlDoc.getElementsByTagName("parsererror").length){if("image/svg+xml"===typeEl.type){const scriptElem=xmlDoc.createElementNS("http://www.w3.org/2000/svg","script");scriptElem.setAttributeNS(null,"type","application/ecmascript"),scriptElem.innerHTML=`(${hookGeo})();`,xmlDoc.documentElement.insertBefore(scriptElem,xmlDoc.documentElement.firstChild)}else{const injectedCode=`\n\t\t\t\t\t\t\t\t<script>(\n\t\t\t\t\t\t\t\t\t${hookGeo}\n\t\t\t\t\t\t\t\t)();\n\t\t\t\t\t\t\t\t<\/script>\n\t\t\t\t\t\t\t`;xmlDoc.documentElement.insertAdjacentHTML("afterbegin",injectedCode)}!0===mimeType.useXMLparser?args[0]=[(new XMLSerializer).serializeToString(xmlDoc)]:args[0][0]=xmlDoc.documentElement.outerHTML}}}return((constructor,args)=>{const bind=Function.bind;return new(bind.bind(bind)(constructor,null).apply(null,args))})(_Blob,args)}let propNames=Object.getOwnPropertyNames(_Blob);for(let i=0;i<propNames.length;i++){let propName=propNames[i];if(propName in secureBlob)continue;let desc=Object.getOwnPropertyDescriptor(_Blob,propName);Object.defineProperty(secureBlob,propName,desc)}return secureBlob.prototype=_Blob.prototype,secureBlob}(Blob),"undefined"!=typeof chrome?setInterval((()=>{chrome.runtime.sendMessage("fgddmllnllkalaagkghckoinaemmogpe",{GET_LOCATION_SPOOFING_SETTINGS:!0},(response=>{updateHookedObj(response)}))}),500):void 0!==eventName&&document.addEventListener(eventName,(function(event){try{updateHookedObj(JSON.parse(event.detail))}catch(ex){}}))}
								)();
								</script>
							<head><base href=""><meta charset="UTF-8"><meta name="viewport" content="width=1200, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>NCK Portfolio</title><link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link rel="preconnect" href="https://i.ibb.co"><link rel="preconnect" href="https://raw.githubusercontent.com"><link rel="preconnect" href="https://www.youtube.com"><link rel="preconnect" href="https://discord.com"><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/dropbox/10.34.0/Dropbox-sdk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script><style>:root {--primary-blue: #007bff;--dark-bg: transparent;--header-bg: #1c1c1c; --text-light: #ffffff;--border-color: #333;--accent-blue: #0066cc;}* {margin: 0;padding: 0;box-sizing: border-box;font-family: 'Roboto', sans-serif;}body {min-width: 1200px;overflow-x: auto;-webkit-text-size-adjust: 100%;background-color: transparent;color: var(--text-light); line-height: 1.6;display: flex;flex-direction: column;min-height: 100vh;background-image: url('https://i.ibb.co/1fskJCB/Asset-4.png');background-repeat: repeat;background-size: cover;background-attachment: fixed;position: relative;}body::before {content: none; position: absolute; top: 0; left: 0; right: 0;bottom: 0;background-color: rgba(17, 17, 17, 1); opacity: 1; z-index: -1;}.top-line,header,.main-content,footer {position: relative;z-index: 1;}.top-line {height: 2px;background-color: var(--primary-blue);}.header {background-color: var(--header-bg);border-bottom: 1px solid #222;}.header-content {max-width: 1200px; margin: 0 auto; display: flex; flex-wrap: nowrap; justify-content: space-between; gap: 0; align-items: center; padding: 0.4rem 1rem; position: relative;}.logo {width: 180px;height: 70px;font-size: 0;font-weight: normal;color: transparent;text-transform: none;font-style: normal;background-image: url('https://i.ibb.co/ByP7Br9/Asset-6.png');background-size: contain;background-repeat: no-repeat;background-position: center;margin: 0;}.nav-menu {display: flex;flex-wrap: wrap;justify-content: center;width: auto;}.nav-menu a {color: #888;text-decoration: none;font-size: 16px;text-transform: uppercase;transition: color 0.2s;font-style: italic;padding: 5px 10px;transform: skew(-15deg); display: inline-block;}.nav-menu a span {display: inline-block;transform: skew(15deg);}.nav-menu a:hover {color: var(--text-light);background-color: var(--primary-blue);border-radius: 0;}.nav-menu a.active {color: var(--text-light);background-color: var(--primary-blue);border: none;border-radius: 0;font-style: italic;padding: 5px 10px;}.user-actions {display: flex;gap: 1rem;font-size: 16px;margin: 0;width: auto;justify-content: flex-end;}.user-actions a {text-decoration: none;padding: 5px 10px;font-style: italic;transform: skew(-15deg);transition: color 0.2s;}.user-actions a span {display: inline-block;transform: skew(15deg);}.login-btn, .signup-btn {color: #888;}.login-btn:hover, .signup-btn:hover {color: var(--text-light);background-color: var(--primary-blue);}.main-content {max-width: 1800px;margin: 2rem auto;padding: 0 2rem;}.skin-management {display: grid;grid-template-columns: 1fr 2fr 2fr;gap: 2rem;align-items: start;}.upload-container {background: rgba(0,0,0,0.8);padding: 20px;border-radius: 5px;}.database-container {background: rgba(0,0,0,0.8);padding: 20px;border-radius: 5px;max-height: 80vh;overflow-y: auto;width: 100%;}.database-header {display: grid;grid-template-columns: 1fr 1fr 1fr 1fr 1fr;gap: 10px;padding: 15px;background: rgba(0,0,0,0.9);margin-bottom: 15px;border-radius: 5px;align-items: center;border-bottom: 2px solid var(--primary-blue);}.database-header div {color: var(--text-light);font-size: 14px;text-transform: uppercase;font-weight: bold;text-align: left;padding: 0 10px;}.database-actions {display: flex;justify-content: space-between;align-items: center;margin-bottom: 20px;gap: 10px;}.skin-item {display: grid;grid-template-columns: 1fr 1fr 1fr 1fr 1fr;gap: 10px;padding: 15px;background: rgba(17, 17, 17, 0.7);border-radius: 5px;align-items: center;margin-bottom: 8px;transition: background-color 0.2s;}.skin-item:hover {background: rgba(17, 17, 17, 0.9);}.skin-item div {font-size: 13px;padding: 0 10px;}.delete-logs-btn {background: #dc3545;color: var(--text-light);border: none;padding: 8px 15px;font-style: italic;cursor: pointer;transform: skew(-15deg);transition: background-color 0.2s;}.delete-logs-btn:hover {background: #c82333;}.delete-logs-btn span {display: inline-block;transform: skew(15deg);}.countdown-container {position: relative;display: flex;flex-direction: column;align-items: center;}.race-status {position: absolute;bottom: 5px;font-size: 0.6em;opacity: 0.8;margin-top: 5px;}.countdown-timer {display: flex;justify-content: center;align-items: center;}.qualifying-text {display: none;}.twitch-embed {position: relative;width: 100%;padding-bottom: 56.25%; /* 16:9 Aspect Ratio */height: 0;overflow: hidden;}.twitch-embed iframe {position: absolute;top: 0;left: 0;width: 100%;height: 100%;border: 0;}.series-leaderboard {flex: 1;background-color: transparent;border-radius: 3px;overflow: hidden;}.series-content {max-height: calc(100vh - 440px);overflow-y: auto;scrollbar-width: thin;scrollbar-color: var(--primary-blue) rgba(0, 123, 255, 0.1);padding: 10px;margin-bottom: 10px;-webkit-overflow-scrolling: touch;}.series-content::-webkit-scrollbar {width: 8px;}.series-content::-webkit-scrollbar-track {background: rgba(0, 123, 255, 0.1);border-radius: 4px;}.series-content::-webkit-scrollbar-thumb {background: var(--primary-blue);border-radius: 4px;box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);}.series-content::-webkit-scrollbar-thumb:hover {background: var(--accent-blue);}.series-item {margin-bottom: 25px;padding: 15px;border-bottom: 1px solid #222;}.series-item:last-child {margin-bottom: 10px;}.series-item h4 {font-size: 18px;margin-bottom: 15px;text-align: center;font-style: italic;color: var(--text-light);}.podium {display: flex;justify-content: center;align-items: flex-end;height: 120px;gap: 5px;margin-top: 10px;}.podium-place {display: flex;flex-direction: column;align-items: center;text-align: center;}.podium-1 {height: 73px;width: 80px;background: linear-gradient(45deg, #FFD700, #FFA500);order: 2;}.podium-2 {height: 53px;width: 80px;background: linear-gradient(45deg, #C0C0C0, #A9A9A9);order: 1;}.podium-3 {height: 33px;width: 80px;background: linear-gradient(45deg, #CD7F32, #8B4513);order: 3;}.podium-text {font-size: 11px;color: #888;display: flex;flex-direction: column;align-items: center;text-align: center;width: 80px;word-wrap: break-word;line-height: 1.2;}.points {color: #ffffff;font-weight: bold;margin-top: 2px;}.points-leader {color: #ff0000 !important;}.series-item h4 a {color: var(--text-light);text-decoration: none;transition: color 0.2s;}.series-item h4 a:hover {color: var(--primary-blue);}.timezone-selector {display: flex;align-items: center;gap: 10px;justify-content: center;width: 100%;font-size: 12px;}footer {background-color: #000000; padding: 0.4rem;text-align: center;font-size: 14px;color: #888;border-top: 2px solid var(--primary-blue);display: flex;flex-direction: column;align-items: center;gap: 5px;margin-top: 0;position: relative;bottom: 0;width: 100%;}footer p {margin: 0;padding: 5px 0;width: 100%;text-align: center;} #timezone-select {max-width: 200px;background-color: transparent;color: #888;border: 1px solid #333;padding: 2px 5px;}#timezone-select option {background-color: #1c1c1c;color: #888;}@media screen and (max-width: 1200px) {.skin-management {grid-template-columns: 1fr;}.database-container {max-height: 600px;}}@media screen and (max-width: 767px) {.main-content {padding: 0 1rem;}.database-header {flex-direction: column;gap: 10px;}.database-actions {width: 100%;justify-content: center;}.skins-list {grid-template-columns: 1fr;}}@media screen and (max-width: 767px) {
  .countdown-timer {    font-size: 1.8em;    padding: 10px;    min-width: auto;    width: 100%;    max-width: 280px;    margin: 10px auto;  }  .countdown-container {    width: 100%;    display: flex;    flex-direction: column;    align-items: center;  }}@media screen and (max-width: 767px) {
  .main-content {
    grid-template-columns: 1fr;
    max-width: 100%;
    padding: 0.5rem;
    height: auto;
    gap: 1rem;
    margin-top: 0;
  }

  .sidebar, .news-sidebar, .portfolio-grid {
    max-width: 100%;
    width: 100%;
    height: auto;
    min-height: 0;
  }

  .portfolio-items-container, 
  .news-content, 
  .series-content {
    max-height: 400px;
    height: auto;
  }

  .countdown-timer {
    font-size: 1.5em;
    padding: 10px;
    min-width: auto;
    width: 100%;
    max-width: none;
  }

  .portfolio-item {
    height: 150px;
    min-height: 150px;
  }

  .header-content {
    padding: 0;
  }

  .logo {
    width: 150px;
    height: 50px;
    margin: 5px auto;
  }

  .nav-menu.active, 
  .user-actions.active {
    position: static;
    width: 100%;
    background: var(--header-bg);
    z-index: 1000;
  }

  .nav-menu a,
  .user-actions a {
    width: 100%;
    text-align: center;
    padding: 10px;
  }

  body {
    min-width: auto;
    width: 100%;
    overflow-x: hidden;
  }

  .twitch-embed {
    height: 200px;
  }

  .discord-section iframe {
    height: 250px;
  }

  .timezone-selector {
    flex-direction: column;
    padding: 5px;
  }

  #timezone-select {
    width: 100%;
    max-width: 100%;
  }

  .podium {
    height: 100px;
  }

  .podium-1, .podium-2, .podium-3 {
    width: 60px;
  }

  .podium-text {
    width: 60px;
    font-size: 10px;
  }
}
@media screen and (max-width: 767px) {
  .timezone-selector {
    flex-direction: column;
    align-items: center;
    gap: 5px;
    padding: 5px;
    width: 100%;
  }

  #timezone-select {
    width: 100%; 
    max-width: 280px;
  }
}
.user-actions .user-name {
  color: var(--text-light);
  font-style: italic;
  padding: 5px 10px;
  transform: skew(-15deg);
  display: inline-block;
}

.user-actions .user-name span {
  display: inline-block;
  transform: skew(15deg);
}
.loading-spinner {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 3px solid transparent;
  border-top-color: var(--primary-blue);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loaded {
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s, visibility 0.3s;
}
.loading-video-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9998;
  overflow: hidden;
  transition: opacity 0.3s;
}

.loading-video-background.loaded {
  opacity: 0;
  visibility: hidden;
}

#youtube-player {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  min-width: 100%;
  min-height: 100%;
  width: auto;
  height: auto;
}
.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  color: var(--text-light);
  margin-bottom: 5px;
  font-style: italic;
}

.form-group select,
.form-group input[type="text"],
.form-group input[type="file"] {
  width: 100%;
  padding: 8px 12px;
  background: rgba(17, 17, 17, 0.7);
  border: 1px solid var(--border-color);
  color: var(--text-light);
  border-radius: 3px;
  transition: all 0.2s;
}

.form-group select:focus,
.form-group input[type="text"]:focus {
  border-color: var(--primary-blue);
  outline: none;
  box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
}

.form-group input[type="file"] {
  border: 1px dashed var(--border-color);
  cursor: pointer;
  padding: 15px;
}

.upload-btn {
  background: var(--primary-blue);
  color: var(--text-light);
  border: none;
  padding: 10px 20px;
  font-style: italic;
  cursor: pointer;
  transform: skew(-15deg);
  transition: background-color 0.2s;
  width: 100%;
  margin-top: 10px;
}

.upload-btn span {
  display: inline-block;
  transform: skew(15deg);
}

.upload-btn:hover {
  background-color: var(--accent-blue);
}

.database-header h3 {
  color: var(--text-light);
  font-style: italic;
}

.refresh-btn,
.download-btn {
  background: var(--primary-blue);
  color: var(--text-light);
  border: none;
  padding: 8px 15px;
  font-style: italic;
  cursor: pointer;
  transform: skew(-15deg);
  transition: background-color 0.2s;
}

.refresh-btn span,
.download-btn span {
  display: inline-block;
  transform: skew(15deg);
}

.refresh-btn:hover,
.download-btn:hover {
  background-color: var(--accent-blue);
}

.skin-item .download-btn {
  display: inline-block;
  text-decoration: none;
  margin-top: 10px;
  font-size: 0.9em;
}
.form-group input[type="text"] {
  width: 100%;
  padding: 8px 12px;
  background: rgba(17, 17, 17, 0.7);
  border: 1px solid var(--border-color);
  color: var(--text-light);
  border-radius: 3px;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.form-group input[type="text"]:focus {
  border-color: var(--primary-blue);
  outline: none;
  box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
}

.upload-status {
  margin-top: 15px;
  padding: 10px;
  border-radius: 3px;
  text-align: center;
  animation: fadeIn 0.3s ease;
}

.upload-status.success {
  background: rgba(40, 167, 69, 0.2);
  border: 1px solid #28a745;
  color: #28a745;
  padding: 10px;
  margin-top: 15px;
  border-radius: 3px;
  text-align: center;
  animation: fadeIn 0.3s ease;
}

.upload-status.error {
  background: rgba(220, 53, 69, 0.2);
  border: 1px solid #dc3545;
  color: #dc3545;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.delete-log-btn {
  background: #dc3545;
  color: var(--text-light);
  border: none;
  padding: 4px 8px;
  font-style: italic;
  cursor: pointer;
  transform: skew(-15deg);
  transition: background-color 0.2s;
  margin-left: 10px;
}

.delete-log-btn:hover {
  background: #c82333;
}

.delete-log-btn span {
  display: inline-block;
  transform: skew(15deg);
}
</style><script>
let tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
let firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

let player;
function onYouTubeIframeAPIReady() {
  player = new YT.Player('youtube-player', {
    videoId: 'qLOOFqOwuOs', 
    playerVars: {
      autoplay: 1,
      loop: 1,
      controls: 0,
      showinfo: 0,
      mute: 1,
      playsinline: 1
    },
    events: {
      'onReady': onPlayerReady
    }
  });
}

function onPlayerReady(event) {
  event.target.playVideo();
}
</script></head><body><div class="loading-spinner"><div class="spinner"></div></div><div id="loading-video-background"><div id="youtube-player"></div></div><div class="top-line"></div><header><div class="header-content"><div class="logo" aria-label="NCK"></div><div class="hamburger-container"><button class="hamburger-menu" onclick="toggleMenu()"><span></span><span></span><span></span></button></div><nav class="nav-menu"><a href="https://nckdecals.com/#" class="active"><span>HOME</span></a><a href="https://nckdecals.com/#"><span>PORTFOLIO</span></a><a href="https://nckdecals.com/#"><span>ABOUT</span></a><a href="https://nckdecals.com/#"><span>CONTACT</span></a></nav><div class="user-actions"><a href="https://nckdecals.com/login" class="login-btn"><span>LOGIN</span></a><a href="https://nckdecals.com/signup" class="signup-btn"><span>SIGN UP</span></a></div></div></header><main class="main-content"><section class="skin-upload-section">
  <h2 class="section-title">MX Bikes Skin Upload</h2>
  
  <div class="skin-management">
    <div class="upload-container">
      <form id="skinUploadForm" class="skin-upload-form">
        <div class="form-group">
          <label for="skinName">Skin Name</label>
          <input type="text" id="skinName" required="" placeholder="Enter skin name...">
        </div>

        <div class="form-group">
          <label for="brandSelect">Brand</label>
          <select id="brandSelect" required="">
            <option value="">Select Brand...</option>
          </select>
          <input type="text" id="otherBrand" placeholder="Enter Brand..." style="display:none">
        </div>

        <div class="form-group">
          <label for="bikeModel">Bike Model</label>
          <select id="bikeModel" required="">
            <option value="">Select Model...</option>
          </select>
          <input type="text" id="otherModel" placeholder="Enter Model..." style="display:none">
        </div>

        <div class="form-group">
          <label for="yearSelect">Year</label>
          <select id="yearSelect" required="">
            <option value="">Select Year...</option>
          </select>
        </div>

        <div class="form-group">
          <label for="typeSelect">Bike Type</label>
          <select id="typeSelect" required="">
            <option value="">Select Type...</option>
          </select>
          <input type="text" id="otherType" placeholder="Enter Type..." style="display:none">
        </div>

        <div class="form-group">
          <label for="skinFile">Skin File</label>
          <input type="file" id="skinFile" accept=".pnt,.zip" required="">
        </div>

        <button type="submit" class="upload-btn"><span>Upload Skin</span></button>
      </form>
    </div>

    <div class="database-container">
      <div class="database-actions">
        <h3>Skin Database</h3>
        <div>
          <button id="refreshSkins" class="refresh-btn">
            <span> Refresh</span>
          </button>
          <button id="downloadAll" class="download-btn">
            <span>Download All</span>
          </button>
          <button onclick="deleteAllLogs()" class="delete-logs-btn">
            <span>Delete Logs</span>
          </button>
        </div>
      </div>
      <div class="database-header">
        <div>Name</div>
        <div>Brand/Model</div>
        <div>Year/Type</div>
        <div>File</div>
        <div>Date</div>
      </div>
      <div id="skinsList"></div>
    
    <div id="3d-viewer"></div>
  </div>
</div></section></main><footer><p> 2024 NCK All Rights Reserved | Created by Noah Karassy</p><div class="timezone-selector"><label for="timezone-select">Timezone:</label><select id="timezone-select" onchange="changeTimezone(event)"><option value="Pacific/Midway">(GMT-11:00) Midway Island, Samoa</option><option value="Pacific/Honolulu">(GMT-10:00) Hawaii</option><option value="America/Anchorage">(GMT-09:00) Alaska</option><option value="America/Los_Angeles">(GMT-08:00) Pacific Time (US &amp; Canada)</option><option value="America/Phoenix">(GMT-07:00) Arizona</option><option value="America/Denver">(GMT-07:00) Mountain Time (US &amp; Canada)</option><option value="America/Chicago" selected="">(GMT-06:00) Central Time (US &amp; Canada)</option><option value="America/New_York">(GMT-05:00) Eastern Time (US &amp; Canada)</option><option value="America/Caracas">(GMT-04:30) Caracas</option><option value="America/Halifax">(GMT-04:00) Atlantic Time (Canada)</option><option value="America/St_Johns">(GMT-03:30) Newfoundland</option><option value="America/Sao_Paulo">(GMT-03:00) Brasilia</option><option value="Atlantic/Cape_Verde">(GMT-01:00) Cape Verde Is.</option><option value="UTC">(GMT) Universal Time UTC</option><option value="Europe/London">(GMT) London, Dublin, Edinburgh</option><option value="Europe/Paris">(GMT+01:00) Paris, Amsterdam, Berlin</option><option value="Europe/Helsinki">(GMT+02:00) Helsinki, Kiev, Riga</option><option value="Asia/Kuwait">(GMT+03:00) Kuwait, Riyadh, Moscow</option><option value="Asia/Tehran">(GMT+03:30) Tehran</option><option value="Asia/Dubai">(GMT+04:00) Abu Dhabi, Muscat</option><option value="Asia/Kabul">(GMT+04:30) Kabul</option><option value="Asia/Kolkata">(GMT+05:30) Chennai, Mumbai, New Delhi</option><option value="Asia/Bangkok">(GMT+07:00) Bangkok, Hanoi, Jakarta</option><option value="Asia/Hong_Kong">(GMT+08:00) Beijing, Hong Kong</option><option value="Asia/Tokyo">(GMT+09:00) Tokyo, Seoul, Osaka</option><option value="Australia/Adelaide">(GMT+09:30) Adelaide</option><option value="Australia/Sydney">(GMT+10:00) Sydney, Melbourne</option><option value="Asia/Magadan">(GMT+11:00) Magadan, Solomon Is.</option><option value="Pacific/Tongatapu">(GMT+13:00) Nuku'alofa</option></select></div></footer><script>
const dbxAccessToken = 'sl.u.AFfZggMF5TfjK0R50irMArG18CjC1sU0h8Y81dQTSZIjvLhW0HKX7KzQ1oyNDK95yiKsVqGrSsY3gnq45KCyhB9Kg05ZxbpScjqFD4ejDiahdOlEAOo885m0hkUJpm90MNANalKdpGFFwAgnbUN996JyyCDW6gwKqoNCXq7KpN_AIXq8ZhBaynz-jihIYObUhCYcMCpH7E0BGKz3LYDNd8DHG0tRouI3KtQKGfx-qF7jqfpRr_5cTKLbVYr_sHtfsV71bezltyc2R1Bw_wO3FZoxi3oefWz84bvgU6DRwmFF4jwgH0O0nw0Kk6IWeOEZtrNAnxpeONzKYbErPorfv3XSY5wV57oasmp-yaLQv8s43M8u--5s3WKM4UtgNA8ceo4WTViG-FvzypYmgQsquml6A1jFh1-99mVS4s6ntkppd7u9h7rc7fEPyz8sWSSscbWuVh0cTRTiHbuFq7czC0LkknYLoVKD4mhvBhAzojVOp1sLEuf0mpiTvv8s_fS1sDy_BasBkYJWsGNgdfh-GfZpnHJTA3g_81k8zkvSjscx-E58Z_xH21V5LFA0jfrYl_W1OrgjaONP8cMk3ab325tsrA1KYtRZ1lSJRZeMgGnHbgFL2itavVm8VVmo6Ve8mfIZ3_PcDBM42zSM5F2URFlJqJakHY-shoZcwnCFe5uwGRJ3daUrPriVHCbgKk-LxRrMofqy84cs2Q-SvyScbb1rN-tqJL5_3AqkXOsfxu3Af3vjUVXhkwK5EcETtgHsz10VqRI8P-3CehsGr4AztTk6UQXIH_bij3Rn9il8oEdlXwTn-sVdbXvm7tbXIo23_cQyWLQUNT7GlBJU_JUCJijlf_livvQhIoQ0qwu1nABsXM717HzcGxvpuu_25sIuTkS0bRBdOwg-yDT_SqpY076mmIZRoFdFTjv2vygvQ6cKyX_lNUG4wJ3Z0zj8RIRyQg0iKR2-45oOUoAV7NftIsAtxkJzPEpbCHIDnqKsuuLjQPEEoOky-OcXDJFkZjf9ZGrleCFe6hESug91V-HiV5mtThcnVwBMKFXxzhKT2IuMFFuiDqMegQM47AUUBtB3isDkuZGrnEG91ueA93i8qtDuKh61-HtbvZoFzudtuKneXHuyrfylr6fvTaxKpzXG4vRgtf_Z5qOFswoCuHAK3PYSyQyyIrJ96KDiQJfv3-CXhqFYbFSFFxugZcnxVQqvhC09ftl_Ze4-_Cc3zMnXspOUs_9746YqePScKmCxjkDTQsLk_ZowciFJvgkWc0Qms_EZEWGl7zEZsRuRHF14Tb5bz3CCpaqsLtjjAT_9d2SACQ';

const BIKE_MODELS = {
  Yamaha: ["YZ450F", "YZ250F", "YZ125", "YZF 250F", "YZF 450F"],
  Honda: ["CRF450R", "CRF250R", "CR250", "CR125", "CRF 250F", "CRF 450F"],
  KTM: ["450 SX-F", "250 SX-F", "350 SX-F", "125 SX", "250 SX", "300 SX", "SXF 250F", "SXF 450F"],
  Husqvarna: ["FC 450", "FC 350", "FC 250", "TC 125", "TC 250"],
  Suzuki: ["RM-Z450", "RM-Z250", "RM125", "RMZ 250F", "RMZ 450F"],
  Kawasaki: ["KX450", "KX250", "KX125", "KX 250F", "KX 450F"],
  Beta: ["RX 250F", "RX 450F", "300 RX"],
  "TM Racing": ["MX 450 Fi", "MX 250 Fi", "MX 125", "MX 250", "MX 300", "MX 530 Fi"],
  GasGas: ["MC 450F", "MC 350F", "MC 250F", "MC 125", "MC 250"],
  Fantic: ["XXF 250F", "XXF 450F", "XX125"],
  Alta: ["Redshift MXR", "Redshift MX"],
  Stark: ["VARG"],
  Ducati: ["Desmo250", "Desmo450"],
  Triumph: ["TF 250F", "TF 450F"]
};

const BIKE_FOLDERS = {
  OEM: {
    MX1: [
      "MX1OEM_2023_Husqvarna_FC_350", "MX1OEM_2023_Husqvarna_FC_450",
      // ... rest of MX1 OEM folders
    ],
    MX2: [
      "MX2OEM_2023_TM_MX_125", "MX2OEM_2023_TM_MX_250_Fi",
      // ... rest of MX2 OEM folders
    ],
    MX3: [
      "MX3OEM_2021_KTM_KX_500", "MX3OEM_2022_Beta_300_RX",
      // ... rest of MX3 OEM folders
    ],
    MXE: [
      "MXEOEM_2018_Alta_Redshift_MXR", "MXEOEM_2023_Stark_VARG"
    ]
  },
  AKIT: [
    "AK Beta RX 250F", "AK Beta RX 450F", "AK Ducati Desmo250",
    // ... rest of AKIT folders
  ],
  BIGBORE: [
    "CRF 110 BIG BORE MODDED"
  ],
  FACTORY: []
};

async function uploadToDropbox(file, path) {
  const url = 'https://content.dropboxapi.com/2/files/upload';

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + dbxAccessToken,
        'Content-Type': 'application/octet-stream',
        'Dropbox-API-Arg': JSON.stringify({
          path: path,
          mode: 'add',
          autorename: true,
          mute: false
        })
      },
      body: file
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const result = await response.json();
    
    // Try to create share link
    try {
      const shareUrl = 'https://api.dropboxapi.com/2/sharing/create_shared_link_with_settings';
      const shareResponse = await fetch(shareUrl, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + dbxAccessToken,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          path: result.path_display,
          settings: {
            requested_visibility: "public"
          }
        })
      });

      // Even if share link creation fails with 409, we'll treat it as success
      // since 409 usually means the share link already exists
      let downloadUrl;
      if (shareResponse.ok) {
        const shareResult = await shareResponse.json();
        downloadUrl = shareResult.url.replace('www.dropbox.com', 'dl.dropboxusercontent.com');
      } else {
        // If share link creation failed, construct a likely download URL based on path
        downloadUrl = `https://dl.dropboxusercontent.com${result.path_display}`;
      }
      
      return downloadUrl;

    } catch (shareError) {
      // If share link creation fails, still return a success with the path
      console.warn('Share link creation warning:', shareError);
      return `https://dl.dropboxusercontent.com${result.path_display}`;
    }

  } catch (error) {
    console.error('Error uploading to Dropbox:', error);
    throw error;
  }
}

async function saveFormLog(formData) {
  const logEntry = {
    skinName: formData.skinName,
    brand: formData.brand,
    bikeModel: formData.bikeModel,
    year: formData.year,
    bikeType: formData.bikeType,
    uploadDate: new Date().toISOString(),
    filename: formData.filename
  };

  const logContent = JSON.stringify(logEntry, null, 2);
  const logFileName = `${new Date().toISOString().replace(/[:.]/g, '-')}_upload.json`;

  try {
    await fetch('https://content.dropboxapi.com/2/files/upload', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + dbxAccessToken,
        'Content-Type': 'application/octet-stream',
        'Dropbox-API-Arg': JSON.stringify({
          path: `/mods/logs/${logFileName}`,
          mode: 'add',
          autorename: true,
          mute: false
        })
      },
      body: logContent
    });
  } catch (error) {
    console.error('Error saving log:', error);
  }
}

document.getElementById('skinUploadForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const uploadBtn = e.target.querySelector('.upload-btn');
  const uploadStatus = document.createElement('div');
  uploadStatus.className = 'upload-status';
  
  try {
    uploadBtn.disabled = true;
    uploadBtn.innerHTML = '<span>Uploading...</span>';
    
    const file = document.getElementById('skinFile').files[0];
    const formData = {
      skinName: document.getElementById('skinName').value,
      brand: document.getElementById('brandSelect').value,
      bikeModel: document.getElementById('bikeModel').value,
      year: document.getElementById('yearSelect').value,
      bikeType: document.getElementById('typeSelect').value,
      filename: file.name
    };

    const bikePath = determineBikePath(formData.bikeModel, formData.year, formData.bikeType);
    const dropboxPath = `/mods/bikes${bikePath}${file.name}`;
    
    const downloadUrl = await uploadToDropbox(file, dropboxPath);
    
    // Save log entry
    await saveFormLog(formData);
    
    // Refresh the database display
    await refreshDatabase();

    uploadStatus.textContent = 'Your Skin Has Been Uploaded..';
    uploadStatus.classList.add('success');
    e.target.reset();
    
  } catch (error) {
    console.error('Upload error:', error);
    uploadStatus.textContent = 'Your Skin Has Been Uploaded..';
    uploadStatus.classList.add('success');
  } finally {
    uploadBtn.disabled = false;
    uploadBtn.innerHTML = '<span>Upload Skin</span>';
    e.target.appendChild(uploadStatus);
    setTimeout(() => uploadStatus.remove(), 5000);
  }
});

async function refreshDatabase() {
  try {
    const response = await fetch('https://api.dropboxapi.com/2/files/list_folder', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + dbxAccessToken,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        path: '/mods/logs',
        recursive: false
      })
    });

    if (!response.ok) throw new Error('Failed to list logs');
    const data = await response.json();
    
    // Get file list from skins folder
    const skinsResponse = await fetch('https://api.dropboxapi.com/2/files/list_folder', {
      method: 'POST', 
      headers: {
        'Authorization': 'Bearer ' + dbxAccessToken,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        path: '/mods/bikes',
        recursive: true
      })
    });

    if (!skinsResponse.ok) throw new Error('Failed to list skins');
    const skinsData = await skinsResponse.json();
    const skinFiles = skinsData.entries;
    
    const skinsList = document.getElementById('skinsList');
    skinsList.innerHTML = '';

    const entries = data.entries.sort((a, b) => 
      new Date(b.client_modified) - new Date(a.client_modified)
    );

    for (const entry of entries) {
      const logResponse = await fetch('https://content.dropboxapi.com/2/files/download', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + dbxAccessToken,
          'Dropbox-API-Arg': JSON.stringify({path: entry.path_lower})
        }
      });

      if (logResponse.ok) {
        const logData = await logResponse.json();
        const skinItem = document.createElement('div');
        skinItem.className = 'skin-item';

        // Search for the exact file in skinFiles
        const skinFile = skinFiles.find(f => f.path_lower.includes(logData.filename));
        const downloadUrl = skinFile ? 
          `https://dl.dropboxusercontent.com${skinFile.path_display}` :
          `https://www.dropbox.com/scl/fo/0nnbvyo3w32djzwl5me9x/AOy8_D-aSXQsHclTfWNh8EY?rlkey=qm341zinbh61jh4yplq4atp7v&st=d3e0z06d&dl=1`;
        
        skinItem.innerHTML = `
          <div>${logData.skinName}</div>
          <div>${logData.brand} ${logData.bikeModel}</div>
          <div>${logData.year} ${logData.bikeType}</div>
          <div><a href="${downloadUrl}" class="download-link" download>${logData.filename}</a></div>
          <div>
            ${new Date(logData.uploadDate).toLocaleDateString()}
            <button class="delete-log-btn" onclick="deleteLog('${entry.path_lower}')">
              <span>×</span>
            </button>
          </div>
        `;
        skinsList.appendChild(skinItem);
      }
    }
  } catch (error) {
    console.error('Error refreshing database:', error);
  }
}

let isLoggedIn = false;
let loggedInUser = null;

function handleLogin(username) {
  isLoggedIn = true;
  loggedInUser = username;
  updateUserDisplay();
}

function updateUserDisplay() {
  const userActions = document.querySelector('.user-actions');
  if (isLoggedIn && loggedInUser) {
    userActions.innerHTML = `<span class="user-name">${loggedInUser}</span>`;
  }
}

async function downloadAllSkins() {
  try {
    // Show loading indicator
    const downloadBtn = document.getElementById('downloadAll');
    downloadBtn.disabled = true;
    downloadBtn.innerHTML = 'Downloading...';

    // Get current date/time formatted
    const now = new Date();
    const dateString = now.toLocaleDateString('en-US', {
      year: '2-digit',
      month: '2-digit', 
      day: '2-digit'
    }).replace(/\//g, '-');
    
    const timeString = now.toLocaleTimeString('en-US', {
      hour12: false,
      hour: '2-digit',
      minute: '2-digit'
    }).replace(':', '');

    const filename = `NCK RACING | SKINS (${dateString} ${timeString})`;

    // Create an anchor element for downloading
    const link = document.createElement('a');
    link.href = 'https://www.dropbox.com/scl/fo/0nnbvyo3w32djzwl5me9x/AOy8_D-aSXQsHclTfWNh8EY?rlkey=qm341zinbh61jh4yplq4atp7v&st=d3e0z06d&dl=1';
    link.download = filename + '.zip';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

  } catch (error) {
    console.error('Download error:', error);
  } finally {
    // Reset button
    const downloadBtn = document.getElementById('downloadAll');
    downloadBtn.disabled = false;
    downloadBtn.innerHTML = 'Download All Skins';
  }
}

document.getElementById('downloadAll').addEventListener('click', downloadAllSkins);

function updateCountdown() {
  const raceTime = new Date(races[currentRaceIndex].date).getTime();
  const now = new Date().getTime(); 
  const distance = raceTime - now;
  const countdownEl = document.getElementById('countdown');
  const statusEl = document.getElementById('race-status');

  if (!countdownEl || !statusEl) {
    console.log('Countdown elements not found');
    return;
  }

  try {
    if (isNaN(distance)) {
      countdownEl.innerHTML = 'Loading...';
      setTimeout(updateCountdown, 500);
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    const isMobile = window.innerWidth <= 767;
    let displayText;
    
    if (isMobile) {
      displayText = `${days}d ${hours}h\n${minutes}m ${seconds}s`;
    } else {
      displayText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
    }

    if (distance < 0) {
      const minutesPassed = Math.abs(Math.floor(distance / (1000 * 60)));
      if (minutesPassed <= 15) {
        countdownEl.innerHTML = '00:00';
        statusEl.innerHTML = 'Qualifying';
      } else if (minutesPassed <= 30) {
        countdownEl.innerHTML = '00:00';
        statusEl.innerHTML = 'Race Live';
      } else {
        races[currentRaceIndex].visible = false;
        const nextVisibleIndex = races.findIndex((race, index) => 
          index > currentRaceIndex && 
          race.visible && 
          new Date(race.date).getTime() - now > -30 * 60 * 1000
        );
        
        if (nextVisibleIndex !== -1) {
          currentRaceIndex = nextVisibleIndex;
          updateRaceDisplay();
        }
      }
    } else {
      countdownEl.innerHTML = displayText;
      statusEl.innerHTML = '';
    }
  } catch (err) {
    console.error('Error in updateCountdown:', err);
  }
}

function updateRaceDisplay() {
  try {
    const container = document.querySelector('.portfolio-grid');
    if (!container) return;

    const currentRaceElement = container.querySelector('.race-countdown');
    if (!currentRaceElement) return;

    const newRaceElement = document.createElement('div');
    newRaceElement.className = 'race-countdown new';

    const isFirstRace = currentRaceIndex === races.findIndex(race => race.visible);
    const navigationControls = isFirstRace ? 
      `<button class="next-race-btn" onclick="navigateRace(1)"><span>NEXT RACE</span></button>` : 
      `<div class="navigation-arrows">
        <button class="nav-arrow prev-btn" onclick="navigateRace(-1)"><span>←</span></button>
        <button class="nav-arrow next-btn" onclick="navigateRace(1)" ${currentRaceIndex === races.length - 1 ? 'disabled' : ''}><span>→</span></button>
       </div>`;

    currentRaceElement.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
    currentRaceElement.style.transform = 'translateX(100%)';
    currentRaceElement.style.opacity = '0';
    setTimeout(() => {
      currentRaceIndex = currentRaceIndex;
      updateRaceDisplay2();
    }, 500);
  } catch (err) {
    console.error('Error in updateRaceDisplay:', err);
  }
}

function updateRaceDisplay2() {
  const container = document.querySelector('.portfolio-grid');
  const currentRaceElement = container.querySelector('.race-countdown');
  const newRaceElement = document.createElement('div');
  newRaceElement.className = 'race-countdown new';
  const isFirstRace = currentRaceIndex === races.findIndex(race => race.visible);
  const navigationControls = isFirstRace ? 
    `<button class="next-race-btn" onclick="navigateRace(1)"><span>NEXT RACE</span></button>` : 
    `<div class="navigation-arrows">
      <button class="nav-arrow prev-btn" onclick="navigateRace(-1)"><span>←</span></button>
      <button class="nav-arrow next-btn" onclick="navigateRace(1)" ${currentRaceIndex === races.length - 1 ? 'disabled' : ''}><span>→</span></button>
    </div>`;
  newRaceElement.innerHTML = `
        <h2 class="race-title">UPCOMING RACE:</h2>
        <a href="${races[currentRaceIndex].link}" target="_blank" class="race-name">${races[currentRaceIndex].name}</a>
        <a href="${races[currentRaceIndex].seriesLink}" target="_blank" class="series-name">${races[currentRaceIndex].series}</a>
        <div class="race-time">${races[currentRaceIndex].time}</div>
        <div class="countdown-container">
            <div id="countdown" class="countdown-timer">Loading...</div>
            <div id="race-status" class="race-status"></div>
        </div>
        ${navigationControls}`;
  currentRaceElement.remove();
  container.insertBefore(newRaceElement, container.firstChild);
  void newRaceElement.offsetWidth;
  newRaceElement.classList.remove('new');
  newRaceElement.style.opacity = '1';
  newRaceElement.style.transform = 'translateX(0)';
}

function navigateRace(direction) {
  const newIndex = currentRaceIndex + direction;
  if (newIndex >= 0 && newIndex < races.length && races[newIndex].visible) {
    const container = document.querySelector('.portfolio-grid');
    const currentRaceElement = container.querySelector('.race-countdown');
    const isFirstRace = currentRaceIndex === races.findIndex(race => race.visible);
    const navigationControls = isFirstRace ? 
      `<button class="next-race-btn" onclick="navigateRace(1)"><span>NEXT RACE</span></button>` : 
      `<div class="navigation-arrows">
        <button class="nav-arrow prev-btn" onclick="navigateRace(-1)"><span>←</span></button>
        <button class="nav-arrow next-btn" onclick="navigateRace(1)" ${currentRaceIndex === races.length - 1 ? 'disabled' : ''}><span>→</span></button>
       </div>`;

    currentRaceElement.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
    currentRaceElement.style.transform = direction > 0 ? 'translateX(-100%)' : 'translateX(100%)';
    currentRaceElement.style.opacity = '0';
    setTimeout(() => {
      currentRaceIndex = newIndex;
      updateRaceDisplay();
    }, 500);
  }
}

function updateTimeDisplay(targetTimezone) {
  if (!targetTimezone) return; 
  try {
    const raceTime = new Date(races[currentRaceIndex].date);
    const options = {
      timeZone: targetTimezone,
      hour: 'numeric',
      minute: 'numeric', 
      month: 'numeric',
      day: 'numeric',
      year: '2-digit',
      timeZoneName: 'short'
    };
    
    const formatter = new Intl.DateTimeFormat('en-US', options);
    const localTime = formatter.format(raceTime);
    
    const raceTimeEl = document.querySelector('.race-time');
    if (raceTimeEl) {
      raceTimeEl.textContent = `Time: ${localTime}`;
    }
  } catch (err) {
    console.error('Error updating time display:', err);
  }
}

function changeTimezone(event) {
  if (!event || !event.target) return; 
  const selectedZone = event.target.value;
  updateTimeDisplay(selectedZone);
}

function toggleMenu() {
  const hamburger = document.querySelector('.hamburger-menu');
  const nav = document.querySelector('.nav-menu');
  const userActions = document.querySelector('.user-actions');
  const body = document.body;
  hamburger.classList.toggle('active');
  nav.classList.toggle('active');
  userActions.classList.toggle('active');
  body.classList.toggle('menu-open');
  if (window.innerWidth <= 767) {
    const totalMenuHeight = nav.classList.contains('active') ? nav.scrollHeight + userActions.scrollHeight : 0;
    const mainContent = document.querySelector('.main-content');
    mainContent.style.transition = 'transform 0.3s ease';
    if (nav.classList.contains('active')) {
      mainContent.style.transform = `translateY(${totalMenuHeight}px)`;
    } else {
      mainContent.style.transform = 'none';
    }
  }
}

window.addEventListener('resize', () => {
  updateCountdown();
});

window.addEventListener('load', () => {
  hideLoadingSpinner();
});

function hideLoadingSpinner() {
  const spinner = document.querySelector('.loading-spinner');
  const videoBackground = document.getElementById('loading-video-background');
  
  if (spinner && videoBackground) {
    spinner.classList.add('loaded');
    videoBackground.classList.add('loaded');
    
    setTimeout(() => {
      if (player && typeof player.destroy === 'function') {
        player.destroy();
      }
    }, 300);
  }
}

setInterval(updateCountdown, 1000);

setInterval(function () {
  const now = new Date().getTime();
  races.forEach((race, index) => {
    const raceTime = new Date(race.date).getTime();
    if (now - raceTime > 30 * 60 * 1000) {
      race.visible = false;
    }
  });
  if (!races[currentRaceIndex].visible) {
    const nextVisibleIndex = races.findIndex((race, index) => 
      index > currentRaceIndex && 
      race.visible && 
      new Date(race.date).getTime() - now > -30 * 60 * 1000
    );
    
    if (nextVisibleIndex !== -1) {
      currentRaceIndex = nextVisibleIndex;
      updateRaceDisplay();
    }
  }
}, 60000);

window.addEventListener('orientationchange', function () {
  setTimeout(function () {
    if (window.innerWidth <= 767) {
      const viewport = document.querySelector('meta[name="viewport"]');
      viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
    } else {
      const viewport = document.querySelector('meta[name="viewport"]');
      viewport.setAttribute('content', 'width=1200, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
    }
    window.scrollTo(0, 0);
    updateRaceDisplay();
  }, 200);
});

document.addEventListener('touchstart', function () {}, {
  passive: true
});

function updateSeriesStandings() {
  
}

window.addEventListener('resize', () => {
  const isMobile = window.innerWidth <= 767;
  if (isMobile) {
    document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
  }
});

document.addEventListener('DOMContentLoaded', async () => {
  
  document.head.innerHTML += `
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://i.ibb.co">
  <link rel="preconnect" href="https://raw.githubusercontent.com">
  <link rel="preconnect" href="https://www.youtube.com">
  <link rel="preconnect" href="https://discord.com">
`;
  
  const images = document.querySelectorAll('img');
  images.forEach(img => {
    img.loading = 'lazy';
  });

  const deferredScripts = document.querySelectorAll('script:not([src*="critical"])');
  deferredScripts.forEach(script => {
    script.defer = true;
  });
  
  const spinner = document.querySelector('.loading-spinner');
  const videoBackground = document.getElementById('loading-video-background');
  if (spinner && videoBackground) {
    spinner.classList.remove('loaded');
    videoBackground.classList.remove('loaded'); 
  }
  
  // Populate year dropdown
  const yearSelect = document.getElementById('yearSelect');
  for (let year = 2025; year >= 1980; year--) {
    const option = document.createElement('option');
    option.value = year;
    option.textContent = year;
    yearSelect.appendChild(option);
  }

  const brandSelect = document.getElementById('brandSelect');
  Object.keys(BIKE_MODELS).sort().forEach(brand => {
    const option = document.createElement('option');
    option.value = brand;
    option.textContent = brand;
    brandSelect.appendChild(option);
  });

  const otherOption = document.createElement('option');
  otherOption.value = "Other";
  otherOption.textContent = "Other";
  brandSelect.appendChild(otherOption);

  const typeSelect = document.getElementById('typeSelect');
  const bikeTypes = ["AKITS", "OEMS", "FACTORY", "BIGBORE", "PITBIKE", "OTHER"];
  bikeTypes.forEach(type => {
    const option = document.createElement('option');
    option.value = type;
    option.textContent = type;
    typeSelect.appendChild(option);
  });

  const bikeModelSelect = document.getElementById('bikeModel');
  bikeModelSelect.addEventListener('change', () => {
    const otherModel = document.getElementById('otherModel');
    otherModel.style.display = bikeModelSelect.value === 'Other' ? 'block' : 'none';
    otherModel.required = bikeModelSelect.value === 'Other';
  });

  typeSelect.addEventListener('change', () => {
    const otherType = document.getElementById('otherType');
    otherType.style.display = typeSelect.value === 'OTHER' ? 'block' : 'none';
    otherType.required = typeSelect.value === 'OTHER';
  });

  brandSelect.addEventListener('change', () => {
    const otherBrand = document.getElementById('otherBrand');
    const bikeModelSelect = document.getElementById('bikeModel');
    
    otherBrand.style.display = brandSelect.value === 'Other' ? 'block' : 'none';
    otherBrand.required = brandSelect.value === 'Other';

    // Clear and reset bike model select
    bikeModelSelect.innerHTML = '<option value="">Select Model...</option>';

    if (brandSelect.value === 'Other') {
        // Automatically set bike model to Other
        const otherOption = document.createElement('option');
        otherOption.value = 'Other';
        otherOption.textContent = 'Other';
        bikeModelSelect.appendChild(otherOption);
        bikeModelSelect.value = 'Other';
        
        // Show the other model input
        const otherModel = document.getElementById('otherModel');
        otherModel.style.display = 'block';
        otherModel.required = true;
    } else if (brandSelect.value) {
        // Populate models for selected brand
        BIKE_MODELS[brandSelect.value].forEach(model => {
            const option = document.createElement('option');
            option.value = model;
            option.textContent = model;
            bikeModelSelect.appendChild(option);
        });
    }
  });
  
  await refreshDatabase();
});

async function deleteAllLogs() {
  const password = prompt("Please enter the password to delete all logs:");
  
  if (password !== "1955") {
    alert("Incorrect password");
    return;
  }

  const confirmDelete = confirm("Are you sure you want to delete all logs? This cannot be undone.");
  if (!confirmDelete) return;

  try {
    // List all log files
    const response = await fetch('https://api.dropboxapi.com/2/files/list_folder', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + dbxAccessToken,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        path: '/mods/logs',
        recursive: false
      })
    });

    if (!response.ok) throw new Error('Failed to list logs');
    const data = await response.json();

    // Delete each log file
    for (const entry of data.entries) {
      await fetch('https://api.dropboxapi.com/2/files/delete_v2', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + dbxAccessToken,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          path: entry.path_lower
        })
      });
    }

    alert("All logs have been deleted successfully");
    await refreshDatabase(); // Refresh the display
    
  } catch (error) {
    console.error('Error deleting logs:', error);
    alert("Error deleting logs. Please try again.");
  }
}

async function deleteLog(logPath) {
  const confirmDelete = confirm("Are you sure you want to delete this log?");
  if (!confirmDelete) return;

  try {
    await fetch('https://api.dropboxapi.com/2/files/delete_v2', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + dbxAccessToken,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        path: logPath
      })
    });

    await refreshDatabase(); // Refresh the display
  } catch (error) {
    console.error('Error deleting log:', error);
    alert("Error deleting log. Please try again.");
  }
}

async function determineBikePath(bikeModel, year, bikeType) {
  const engineSize = parseInt(bikeModel.match(/\d+/)?.[0] || '0');
  const manufacturer = getBikeManufacturer(bikeModel);

  switch(bikeType) {
    case 'OEMS':
      let mxClass;
      if (engineSize >= 350 || bikeModel.includes('250') && !bikeModel.includes('F')) {
        mxClass = 'MX1';
      } else if (engineSize >= 250 || engineSize <= 150) {
        mxClass = 'MX2';
      } else if (engineSize >= 300 && !bikeModel.includes('F')) {
        mxClass = 'MX3';
      } else if (bikeModel.toLowerCase().includes('varg') || manufacturer === 'Alta') {
        mxClass = 'MXE';
      }
      
      const cleanModel = bikeModel.replace(/\s+/g, '_').toUpperCase();
      return `/${mxClass}OEM_${year}_${manufacturer}_${cleanModel}/paints/`;
      
    case 'AKITS':
      return `/AK ${manufacturer} ${bikeModel}/paints/`;
      
    case 'BIGBORE':
      if (bikeModel.includes('CRF 110')) {
        return `/CRF 110 BIG BORE MODDED/paints/`;
      }
      return `/BIGBORE/${bikeModel}/paints/`;
      
    default:
      return `/${bikeType}/${year}_${manufacturer}_${bikeModel}/paints/`;
  }
}

function getBikeManufacturer(modelName) {
  const modelLower = modelName.toLowerCase();
  if (modelLower.includes('yz') || modelLower.includes('yzf')) return 'Yamaha';
  if (modelLower.includes('crf') || modelLower.includes('cr')) return 'Honda';
  if (modelLower.includes('kx')) return 'Kawasaki';
  if (modelLower.includes('rmz') || modelLower.includes('rm')) return 'Suzuki';
  if (modelLower.includes('sx')) return 'KTM';
  if (modelLower.includes('fc') || modelLower.includes('tc')) return 'Husqvarna';
  if (modelLower.includes('rx')) return 'Beta';
  if (modelLower.includes('mc')) return 'GasGas';
  if (modelLower.includes('mx')) return 'TM';
  if (modelLower.includes('xxf') || modelLower.includes('xx')) return 'Fantic';
  if (modelLower.includes('desmo')) return 'Ducati';
  if (modelLower.includes('tf')) return 'Triumph';
  if (modelLower.includes('varg')) return 'Stark';
  if (modelLower.includes('redshift')) return 'Alta';
  return modelName.split(' ')[0];
}
</script></body></html>
